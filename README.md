# discord-bots

Custom Discord Bots powering the KlimaDAO community.

This is a monorepo containing multiple bots:

- BCT price:
- Guerilla marketing:
- KLIMA price:
- Next rebase:

## Layout

src/

- bct_price/
- guerilla_marketing/
- klima_price/
- next_rebase/

## API Keys

This project requires some API keys to run. When developing locally, you can create your own API keys from the following services:

- Infura: create a new project - https://infura.io/dashboard
  - Note that you need to enable the Polygon add-on: https://infura.io/payment?chosenAddon=ethereum_polygon_addon
- PolygonScan: create an account - https://polygonscan.com/myapikey
- Discord token: https://discord.com/developers/applications
  - Settings -> Bot
- Discord webhook URL: create a personal server, channel settings -> integrations, create webhook

## Deployment

The bots are hosted on Digital Ocean App Platform under a single app. Upon any commit to the `master` branch, the bots are deployed automatically.

Deployment follows this process:

- A Docker image is built and pushed to DOCR using the `Dockerfile`.
- The app is deployed to Digital Ocean, using the built Docker image as the basis.

### Required Environment

The following environment variables must be defined in the Digital Ocean App Platform specification file (app-spec.yml):

BCT Price:

- `DISCORD_BOT_TOKEN`
- `WEB3_INFURA_PROJECT_ID`

Guerilla Marketing:

- `DISCORD_BOT_TOKEN`

KLIMA Price:

- `DISCORD_BOT_TOKEN`
- `WEB3_INFURA_PROJECT_ID`

Next Rebase:

- `DISCORD_BOT_TOKEN_REBASE`
- `DISCORD_REBASE_BOT_WEBHOOK_URL`
- `POLYGONSCAN_API_KEY`
- `WEB3_INFURA_PROJECT_ID`

The app-spec.yml file committed to git contains encrypted secrets that are generated by DOAP. When updating secrets, perform the following steps:

1. Update `app-spec.yml` with the new value for the secret
1. Deploy the app manually: `doctl apps create --upsert --spec app-spec.yml --wait --verbose`
1. Obtain the encrypted secrets from the Digital Ocean control panel: app -> settings -> app spec
1. Add the secrets to the app-spec.yml and commit to git.
